ServerTokens Prod
ServerSignature Off
ServerName {{ apache_url }}

<VirtualHost *:80>
  #Disabling plaintext http and redirecting to https
  #Make sure apache_url has https in it
  Redirect permanent / {{ apache_url  }}/
</VirtualHost>


<VirtualHost *:443>
  ProxyPreserveHost On
  RewriteEngine on
  RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
  RewriteCond %{HTTP:CONNECTION} ^Upgrade$ [NC]
  RewriteRule .* ws://localhost:{{ meteor_port }}%{REQUEST_URI} [P]
  ProxyPass / http://localhost:{{ meteor_port }}/
  ProxyPassReverse / http://localhost:{{ meteor_port }}/
  SSLEngine on
  SSLCertificateFile /etc/apache2/ssl/apache.crt
  SSLCertificateKeyFile /etc/apache2/ssl/apache.key
  SSLCipherSuite HIGH:!aNULL:!MD5

  #Had to do it this way since all traffic goes to grid proxy
  ErrorDocument 503 "<div align='center'><img src='https://raw.githubusercontent.com/ecohealthalliance/grid/master/public/images/eidr-logo.png?token=ADQFP8aP6Qy8q75aMasRDNhPwLRYjY4hks5VlADfwA%3D%3D'><p style='font-size:40px; font-family: Helvetica, Arial, sans-serif;'>EIDR is being updated, please try again in a few minutes.</div>"
</VirtualHost>
